<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Widget v3.2 Unified</title>
    <style>
        /* --- CSS STYLES --- */
        body {
            margin: 0;
            padding: 0;
            /* DEFAULT DARK BACKGROUND */
            background-color: #0f172a; 
            /* UNIFIED BACKGROUND IMAGE */
            background-image: url('Notion Background.webp');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            /* FLEXBOX CENTERING */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: sans-serif;
            color: white;
        }

        /* Dark overlay to make text readable on the main background */
        body::before {
            content: "";
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(15, 23, 42, 0.6); /* Darkens the main BG */
            z-index: -1;
        }

        .main-container {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .widget-box {
            width: 240px;
            height: 240px;
            /* GLASS EFFECT BACKGROUND */
            background: rgba(30, 41, 59, 0.6); /* More transparent */
            backdrop-filter: blur(10px); /* Blurs the background behind the widget */
            -webkit-backdrop-filter: blur(10px);
            
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            overflow: hidden;
        }

        /* VERSION MARKER */
        .version-tag {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 10px;
            color: #4ade80;
            font-weight: bold;
            background: rgba(0,0,0,0.5);
            padding: 2px 6px;
            border-radius: 4px;
            z-index: 10;
        }

        /* CLOCK */
        #time { font-size: 48px; font-weight: bold; margin-bottom: 5px; text-shadow: 0 2px 4px rgba(0,0,0,0.5); }
        #date { font-size: 14px; opacity: 0.9; text-shadow: 0 1px 2px rgba(0,0,0,0.5); }

        /* WEATHER */
        #weather-icon { font-size: 48px; margin-bottom: 5px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5)); }
        #temp { font-size: 32px; font-weight: bold; text-shadow: 0 2px 4px rgba(0,0,0,0.5); }
        #condition { font-size: 14px; opacity: 0.9; margin-bottom: 15px; text-shadow: 0 1px 2px rgba(0,0,0,0.5); }
        
        input[type="file"] { display: none; }
        
        /* WIDGET SPECIFIC BG (Optional - kept for consistency) */
        .bg-img {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            object-fit: cover;
            opacity: 0.2; 
            pointer-events: none;
            z-index: 0;
        }
        .content { z-index: 1; text-align: center; }

    </style>
</head>
<body>

    <input type="file" id="imgUpload" accept="image/*">

    <div class="main-container">
        <div class="widget-box" onclick="document.getElementById('imgUpload').click()">
            <div class="version-tag">v3.2 UNIFIED</div> 
            <img class="bg-img custom-bg" src="Notion Background.webp" onerror="this.style.display='none'"> 
            <div class="content">
                <div id="time">00:00</div>
                <div id="date">Loading...</div>
            </div>
        </div>

        <div class="widget-box">
            <div class="version-tag">v3.2 UNIFIED</div>
            <img class="bg-img custom-bg" src="Notion Background.webp" onerror="this.style.display='none'">
            
            <div class="content">
                <div style="font-size:12px; margin-bottom:10px; font-weight:bold; color:#cbd5e1; text-shadow: 0 1px 2px rgba(0,0,0,0.8);">LAS PI√ëAS</div>
                <div id="weather-icon">‚òÄÔ∏è</div>
                <div id="temp">--¬∞</div>
                <div id="condition">Checking...</div>
            </div>
        </div>
    </div>

    <script>
        // --- 1. CLOCK LOGIC ---
        function updateTime() {
            const now = new Date();
            let h = now.getHours();
            let m = now.getMinutes();
            let s = now.getSeconds();
            h = h < 10 ? '0'+h : h;
            m = m < 10 ? '0'+m : m;
            s = s < 10 ? '0'+s : s;
            
            document.getElementById('time').innerText = h + ":" + m + ":" + s;
            document.getElementById('date').innerText = now.toDateString();
        }
        setInterval(updateTime, 1000);
        updateTime();

        // --- 2. WEATHER LOGIC (With Fix) ---
        function getWeatherDetails(code) {
            const map = {
                0: { desc: "Clear Sky", icon: "‚òÄÔ∏è" },
                1: { desc: "Mainly Clear", icon: "üå§Ô∏è" },
                2: { desc: "Partly Cloudy", icon: "‚õÖ" },
                3: { desc: "Overcast", icon: "‚òÅÔ∏è" }, 
                45: { desc: "Foggy", icon: "üå´Ô∏è" },
                48: { desc: "Rime Fog", icon: "üå´Ô∏è" },
                51: { desc: "Light Drizzle", icon: "üå¶Ô∏è" },
                53: { desc: "Drizzle", icon: "üå¶Ô∏è" },
                55: { desc: "Heavy Drizzle", icon: "üåßÔ∏è" },
                61: { desc: "Light Rain", icon: "üå¶Ô∏è" },
                63: { desc: "Rain", icon: "üåßÔ∏è" },
                65: { desc: "Heavy Rain", icon: "üåßÔ∏è" },
                80: { desc: "Showers", icon: "üå¶Ô∏è" },
                81: { desc: "Showers", icon: "üåßÔ∏è" },
                95: { desc: "Thunderstorm", icon: "‚õàÔ∏è" }
            };
            return map[code] || { desc: "Unknown", icon: "‚ùì" };
        }

        async function updateWeather() {
            try {
                const res = await fetch('https://api.open-meteo.com/v1/forecast?latitude=14.4457&longitude=120.9836&current=temperature_2m,weather_code&timezone=Asia%2FManila');
                const data = await res.json();
                const code = data.current.weather_code;
                const weatherInfo = getWeatherDetails(code);

                document.getElementById('temp').innerText = Math.round(data.current.temperature_2m) + "¬∞";
                document.getElementById('condition').innerText = weatherInfo.desc; 
                document.getElementById('weather-icon').innerText = weatherInfo.icon; 
                
            } catch(e) {
                document.getElementById('condition').innerText = "Offline";
            }
        }
        updateWeather();

        // --- 3. BACKGROUND SYNC LOGIC ---
        // When you upload an image, it updates BOTH the widgets AND the main background
        document.getElementById('imgUpload').addEventListener('change', function(e) {
            if(e.target.files && e.target.files[0]) {
                const reader = new FileReader();
                reader.onload = function(ev) {
                    const newBgUrl = 'url(' + ev.target.result + ')';
                    
                    // 1. Update Main Body Background
                    document.body.style.backgroundImage = newBgUrl;
                    
                    // 2. Update Widget Inner Backgrounds
                    document.querySelectorAll('.custom-bg').forEach(el => {
                        el.src = ev.target.result;
                        el.style.display = 'block';
                    });
                }
                reader.readAsDataURL(e.target.files[0]);
            }
        });
    </script>
</body>
</html>
